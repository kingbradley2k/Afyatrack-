<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AfyaTrack - Community Health Management</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- Theme Toggle -->
  <div class="theme-toggle">
    <button id="themeToggle" class="theme-btn">
      <i class="fas fa-moon"></i>
      <i class="fas fa-sun"></i>
    </button>
  </div>

  <!-- Landing Page -->
  <section id="landing" class="landing active">
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <i class="fas fa-heartbeat"></i>
          <span>AfyaTrack</span>
        </div>
        <div class="nav-links">
          <a href="#features">Features</a>
          <a href="#about">About</a>
          <a href="#contact">Contact</a>
          <button class="btn-outline" id="getStartedBtn">Get Started</button>
        </div>
      </div>
    </nav>

    <div class="hero-section">
      <div class="hero-content">
        <h1>Empowering Community Health Workers</h1>
        <p>Track household visits, monitor health indicators, and generate smart alerts to improve community health outcomes.</p>
        <div class="hero-buttons">
          <button class="btn-primary" id="loginBtn">Login</button>
          <button class="btn-secondary" id="registerBtn">Register</button>
        </div>
      </div>
      <div class="hero-image">
        <div class="health-illustration">
          <i class="fas fa-users"></i>
          <i class="fas fa-clipboard-list"></i>
          <i class="fas fa-chart-line"></i>
          <i class="fas fa-bell"></i>
        </div>
      </div>
    </div>

    <section id="features" class="features-section">
      <h2>Key Features</h2>
      <div class="features-grid">
        <div class="feature-card">
          <i class="fas fa-home"></i>
          <h3>Household Management</h3>
          <p>Register and track household information and member details efficiently.</p>
        </div>
        <div class="feature-card">
          <i class="fas fa-stethoscope"></i>
          <h3>Health Visits</h3>
          <p>Record health observations and follow-up visits with ease.</p>
        </div>
        <div class="feature-card">
          <i class="fas fa-bell"></i>
          <h3>Smart Alerts</h3>
          <p>Automatic alerts for critical health conditions and follow-ups.</p>
        </div>
        <div class="feature-card">
          <i class="fas fa-chart-bar"></i>
          <h3>Analytics Dashboard</h3>
          <p>Monitor community health trends and performance metrics.</p>
        </div>
      </div>
    </section>

    <section id="about" class="about-section">
      <h2>About AfyaTrack</h2>
      <p>AfyaTrack is a comprehensive community health management system designed to support Community Health Volunteers (CHVs) in their vital work. Our platform streamlines data collection, monitoring, and reporting to enhance healthcare delivery in communities.</p>
    </section>

    <footer class="landing-footer">
      <p>&copy; 2025 AfyaTrack. <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
    </footer>
  </section>

  <!-- Auth Section -->
  <section id="auth" class="auth-container">
    <button class="back-to-home" id="backToHome">
      <i class="fas fa-arrow-left"></i> Back to Home
    </button>

    <div class="auth-card">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="login">Login</button>
        <button class="tab" data-tab="register">Register</button>
      </div>

      <!-- Login Form -->
      <form id="login" class="form active">
        <h2>Welcome Back</h2>
        <label for="login-email">Email or Phone</label>
        <input type="text" id="login-email" placeholder="Enter your email or phone" required>

        <label for="login-password">Password</label>
        <input type="password" id="login-password" placeholder="Enter password" required>

        <div class="form-options">
          <label class="checkbox-label">
            <input type="checkbox"> Remember me
          </label>
          <a href="#" class="forgot-password">Forgot password?</a>
        </div>

        <button type="submit" class="btn-primary">Login</button>

        <div class="social-divider">or continue with</div>

        <div class="social-login">
          <!-- Google Sign In Button -->
          <div id="googleSignInBtn"></div>
          
          <!-- Fallback manual button -->
          <button type="button" class="btn-google-manual" onclick="manualGoogleSignIn()" style="display: none;">
            <i class="fab fa-google"></i> Sign in with Google
          </button>
          
          <button type="button" class="btn-facebook">
            <i class="fab fa-facebook-f"></i> Facebook
          </button>
        </div>
      </form>

      <!-- Register Form -->
      <form id="register" class="form">
        <h2>Join AfyaTrack</h2>
        <label for="reg-name">Full Name</label>
        <input type="text" id="reg-name" placeholder="Enter your full name" required>

        <label for="reg-email">Email or Phone</label>
        <input type="text" id="reg-email" placeholder="Enter your email or phone" required>

        <label for="reg-password">Password</label>
        <input type="password" id="reg-password" placeholder="Enter password" required>

        <label for="reg-confirm-password">Confirm Password</label>
        <input type="password" id="reg-confirm-password" placeholder="Confirm password" required>

        <label for="reg-role">Role</label>
        <select id="reg-role" required>
          <option value="">Select Role</option>
          <option value="CHV">Community Health Volunteer (CHV)</option>
          <option value="Supervisor">Supervisor</option>
          <option value="Admin">Administrator</option>
        </select>

        <button type="submit" class="btn-primary">Create Account</button>
      </form>
    </div>
  </section>

  <!-- Role-based Dashboards (Hidden by default) -->
  <section id="chv-dashboard" class="dashboard-container">
    <div class="dashboard-header">
      <button class="back-to-auth" id="backToAuthFromCHV">
        <i class="fas fa-arrow-left"></i> Back to Login
      </button>
      <h1>CHV Dashboard</h1>
      <div class="user-info">
        <span id="chvUserName">Welcome, User!</span>
        <button class="btn-logout" onclick="logout()">Logout</button>
      </div>
    </div>
    
    <div class="dashboard-content">
      <div class="stats-grid">
        <div class="stat-card">
          <i class="fas fa-home"></i>
          <h3>Households</h3>
          <p class="stat-number">24</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-users"></i>
          <h3>Members</h3>
          <p class="stat-number">127</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-calendar-check"></i>
          <h3>Visits Today</h3>
          <p class="stat-number">8</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-bell"></i>
          <h3>Alerts</h3>
          <p class="stat-number">3</p>
        </div>
      </div>

      <!-- Quick Actions Section -->
      <div class="quick-actions">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
          <button class="action-btn" onclick="navigateTo('households')">
            <i class="fas fa-home"></i>
            <span>Manage Households</span>
          </button>
          <button class="action-btn" onclick="navigateTo('visits')">
            <i class="fas fa-clipboard-list"></i>
            <span>Record Visit</span>
          </button>
          <button class="action-btn" onclick="navigateTo('alerts')">
            <i class="fas fa-bell"></i>
            <span>View Alerts</span>
          </button>
          <button class="action-btn" onclick="navigateTo('reports')">
            <i class="fas fa-chart-bar"></i>
            <span>Generate Report</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <section id="supervisor-dashboard" class="dashboard-container">
    <div class="dashboard-header">
      <button class="back-to-auth" id="backToAuthFromSupervisor">
        <i class="fas fa-arrow-left"></i> Back to Login
      </button>
      <h1>Supervisor Dashboard</h1>
      <div class="user-info">
        <span id="supervisorUserName">Welcome, Supervisor!</span>
        <button class="btn-logout" onclick="logout()">Logout</button>
      </div>
    </div>
    
    <div class="dashboard-content">
      <div class="stats-grid">
        <div class="stat-card">
          <i class="fas fa-user-md"></i>
          <h3>CHVs</h3>
          <p class="stat-number">12</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-chart-line"></i>
          <h3>Performance</h3>
          <p class="stat-number">85%</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-flag"></i>
          <h3>Pending Reviews</h3>
          <p class="stat-number">7</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-exclamation-triangle"></i>
          <h3>Critical Cases</h3>
          <p class="stat-number">2</p>
        </div>
      </div>

      <div class="quick-actions">
        <h2>Management Tools</h2>
        <div class="action-buttons">
          <button class="action-btn" onclick="navigateTo('chv-management')">
            <i class="fas fa-users"></i>
            <span>Manage CHVs</span>
          </button>
          <button class="action-btn" onclick="navigateTo('performance')">
            <i class="fas fa-chart-line"></i>
            <span>View Performance</span>
          </button>
          <button class="action-btn" onclick="navigateTo('reports')">
            <i class="fas fa-file-alt"></i>
            <span>Generate Reports</span>
          </button>
          <button class="action-btn" onclick="navigateTo('escalations')">
            <i class="fas fa-exclamation-circle"></i>
            <span>Handle Escalations</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <section id="admin-dashboard" class="dashboard-container">
    <div class="dashboard-header">
      <button class="back-to-auth" id="backToAuthFromAdmin">
        <i class="fas fa-arrow-left"></i> Back to Login
      </button>
      <h1>Admin Dashboard</h1>
      <div class="user-info">
        <span id="adminUserName">Welcome, Administrator!</span>
        <button class="btn-logout" onclick="logout()">Logout</button>
      </div>
    </div>
    
    <div class="dashboard-content">
      <div class="stats-grid">
        <div class="stat-card">
          <i class="fas fa-database"></i>
          <h3>Total Users</h3>
          <p class="stat-number">156</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-cogs"></i>
          <h3>System Health</h3>
          <p class="stat-number">100%</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-shield-alt"></i>
          <h3>Security</h3>
          <p class="stat-number">Active</p>
        </div>
        <div class="stat-card">
          <i class="fas fa-sync"></i>
          <h3>Last Backup</h3>
          <p class="stat-number">2h ago</p>
        </div>
      </div>

      <div class="quick-actions">
        <h2>Administration</h2>
        <div class="action-buttons">
          <button class="action-btn" onclick="navigateTo('user-management')">
            <i class="fas fa-user-cog"></i>
            <span>User Management</span>
          </button>
          <button class="action-btn" onclick="navigateTo('system-settings')">
            <i class="fas fa-cogs"></i>
            <span>System Settings</span>
          </button>
          <button class="action-btn" onclick="navigateTo('analytics')">
            <i class="fas fa-chart-pie"></i>
            <span>Analytics</span>
          </button>
          <button class="action-btn" onclick="navigateTo('backup')">
            <i class="fas fa-database"></i>
            <span>Data Management</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Google OAuth Configuration
    const GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID_HERE'; // Replace with your actual client ID
    
    // Initialize Google OAuth
    function initializeGoogleAuth() {
      if (typeof google === 'undefined') {
        console.warn('Google library not loaded yet');
        document.querySelector('.btn-google-manual').style.display = 'flex';
        return;
      }
      
      google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleGoogleSignIn,
        auto_select: false,
        cancel_on_tap_outside: true
      });
      
      // Render Google Sign In button
      const googleButtonContainer = document.getElementById('googleSignInBtn');
      if (googleButtonContainer) {
        google.accounts.id.renderButton(
          googleButtonContainer,
          {
            type: 'standard',
            theme: 'outline',
            size: 'large',
            text: 'continue_with',
            shape: 'rectangular',
            width: '100%'
          }
        );
      }
    }

    // Handle Google Sign In response
    function handleGoogleSignIn(response) {
      console.log('Google Sign-In response:', response);
      
      try {
        // Decode the JWT token to get user info
        const userData = parseJwt(response.credential);
        
        // Simulate user data from Google
        const user = {
          name: userData.name,
          email: userData.email,
          picture: userData.picture,
          role: determineUserRole(userData.email),
          provider: 'google'
        };
        
        // Store user data
        currentUser = user;
        
        // Show appropriate dashboard based on role
        showDashboard(user.role, user);
        
        // Show success message
        showNotification(`Welcome ${user.name}!`, 'success');
      } catch (error) {
        console.error('Error handling Google sign-in:', error);
        showNotification('Error signing in with Google. Please try again.', 'error');
      }
    }

    // Parse JWT token
    function parseJwt(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
      } catch (error) {
        console.error('Error parsing JWT:', error);
        return {};
      }
    }

    // Determine user role based on email or other logic
    function determineUserRole(email) {
      // Example logic - you can customize this based on your needs
      if (email.includes('admin') || email.includes('administrator')) {
        return 'Admin';
      } else if (email.includes('supervisor') || email.includes('manager')) {
        return 'Supervisor';
      } else {
        return 'CHV'; // Default role
      }
    }

    // Current user state
    let currentUser = null;

    // Theme Management
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    // Check for saved theme or prefer color scheme
    const savedTheme = localStorage.getItem('theme') || 
                      (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    body.setAttribute('data-theme', savedTheme);

    themeToggle.addEventListener('click', () => {
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });

    // Page Navigation
    const landing = document.getElementById('landing');
    const auth = document.getElementById('auth');
    const chvDashboard = document.getElementById('chv-dashboard');
    const supervisorDashboard = document.getElementById('supervisor-dashboard');
    const adminDashboard = document.getElementById('admin-dashboard');
    
    const getStartedBtn = document.getElementById('getStartedBtn');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const backToHome = document.getElementById('backToHome');

    // Back buttons from dashboards
    document.getElementById('backToAuthFromCHV').addEventListener('click', showAuth);
    document.getElementById('backToAuthFromSupervisor').addEventListener('click', showAuth);
    document.getElementById('backToAuthFromAdmin').addEventListener('click', showAuth);

    function showLanding() {
      hideAllSections();
      landing.classList.add('active');
    }

    function showAuth() {
      hideAllSections();
      auth.classList.add('active');
      
      // Re-initialize Google Auth when auth section is shown
      setTimeout(() => {
        initializeGoogleAuth();
      }, 100);
    }

    function showDashboard(role, userData) {
      hideAllSections();
      currentUser = userData;
      
      switch(role) {
        case 'CHV':
          document.getElementById('chvUserName').textContent = `Welcome, ${userData.name}!`;
          chvDashboard.classList.add('active');
          break;
        case 'Supervisor':
          document.getElementById('supervisorUserName').textContent = `Welcome, ${userData.name}!`;
          supervisorDashboard.classList.add('active');
          break;
        case 'Admin':
          document.getElementById('adminUserName').textContent = `Welcome, ${userData.name}!`;
          adminDashboard.classList.add('active');
          break;
      }
    }

    function hideAllSections() {
      landing.classList.remove('active');
      auth.classList.remove('active');
      chvDashboard.classList.remove('active');
      supervisorDashboard.classList.remove('active');
      adminDashboard.classList.remove('active');
    }

    function logout() {
      // Google sign out
      if (currentUser?.provider === 'google') {
        if (typeof google !== 'undefined') {
          google.accounts.id.disableAutoSelect();
          google.accounts.id.revoke(currentUser.email, () => {
            console.log('Google session revoked');
          });
        }
      }
      
      currentUser = null;
      showAuth();
      showNotification('You have been logged out successfully.', 'info');
    }

    function navigateTo(page) {
      // In real implementation, this would load the specific page content
      showNotification(`Navigating to ${page.replace('-', ' ')}...`, 'info');
    }

    // Notification system
    function showNotification(message, type = 'info') {
      // Remove existing notification
      const existingNotification = document.querySelector('.notification');
      if (existingNotification) {
        existingNotification.remove();
      }

      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <i class="fas fa-${getNotificationIcon(type)}"></i>
          <span>${message}</span>
          <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }

    function getNotificationIcon(type) {
      const icons = {
        success: 'check-circle',
        error: 'exclamation-circle',
        warning: 'exclamation-triangle',
        info: 'info-circle'
      };
      return icons[type] || 'info-circle';
    }

    // Event Listeners
    getStartedBtn.addEventListener('click', showAuth);
    loginBtn.addEventListener('click', showAuth);
    registerBtn.addEventListener('click', () => {
      showAuth();
      document.querySelector('[data-tab="register"]').click();
    });
    backToHome.addEventListener('click', showLanding);

    // Tab switching logic
    const tabs = document.querySelectorAll('.tab');
    const forms = document.querySelectorAll('.form');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        forms.forEach(f => f.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
        
        // Re-initialize Google button when switching tabs
        setTimeout(() => {
          initializeGoogleAuth();
        }, 100);
      });
    });

    // Form submissions
    document.getElementById('login').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      // Simulate login - in real app, this would be an API call
      const userData = {
        name: email.split('@')[0],
        email: email,
        role: 'CHV',
        provider: 'email'
      };
      
      showDashboard(userData.role, userData);
      showNotification('Login successful!', 'success');
    });

    document.getElementById('register').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = document.getElementById('reg-name').value;
      const email = document.getElementById('reg-email').value;
      const password = document.getElementById('reg-password').value;
      const confirmPassword = document.getElementById('reg-confirm-password').value;
      const role = document.getElementById('reg-role').value;
      
      if (!role) {
        showNotification('Please select a role', 'error');
        return;
      }
      
      if (password !== confirmPassword) {
        showNotification('Passwords do not match', 'error');
        return;
      }

      const userData = {
        name: name,
        email: email,
        role: role,
        provider: 'email'
      };

      // Simulate registration success
      showNotification(`Account created successfully! Welcome to AfyaTrack as ${role}`, 'success');
      showDashboard(role, userData);
    });

    // Manual Google Sign In trigger (fallback)
    function manualGoogleSignIn() {
      if (typeof google !== 'undefined') {
        google.accounts.id.prompt();
      } else {
        showNotification('Google Sign-In is not available. Please try again.', 'error');
      }
    }

    // Demo login for testing different roles
    function demoLogin(role) {
      const userData = {
        name: `Demo ${role}`,
        email: `demo@${role.toLowerCase()}.com`,
        role: role,
        provider: 'demo'
      };
      showDashboard(role, userData);
      showNotification(`Demo login as ${role}`, 'info');
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Google Auth
      setTimeout(() => {
        initializeGoogleAuth();
      }, 500);
    });
  </script>
</body>
</html>